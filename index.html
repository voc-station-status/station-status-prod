<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>VOC Timeline</title>
<meta charset="utf-8" />
    
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js" charset="utf-8" type="text/javascript"></script>
<script src="d3.layout.timeline.js" charset="utf-8" type="text/javascript"></script>    

<!-- If tooltip is working then add this localy, check licences -->
<script src="tooltip.js"></script>
    
<style type="text/css">

svg {
    margin-left: 200px;
}

div.viz {
    height: 5000px;
    width: 1000px;
}
        
body {
    font: 10px sans-serif;
    background-color: none;
}

text {
    font-size: 15px;
} 
        
.axis path {
  display: none;
}

.axis line {
  shape-rendering: crispEdges;
  stroke: #000;
}

.axis .minor line {
  stroke: #777;
  stroke-dasharray: 2,2;
}
        

path.area {
  fill: #e7e7e7;
}
    
/* D3-tip style */
            

.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background-color:black;
  /*background: rgba(0, 0, 0, 0.8);*/
  color: #fff;
  border-radius: 2px;
  font-size:15px;
  width:1000px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}
    
.about {
font-size:15px;    
}
    
/*container styling*/

#container {
margin:100px;   
}
    
#timeline_plot {
background-color: none;        
}

.my-legend {
margin-left: 200px;        
}
            
</style>
    
</head>

<body>
    
<nav class="navbar navbar-inverse navbar-fixed-top" style="height:60px;">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" style="font-size:30px;color:white;margin-left:-70px;">Status of the data flow for ACTRIS/EMEP VOC data</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <!--<ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>-->
        </div><!--/.nav-collapse -->
      </div>
</nav>    

<div id="container">
        
<script>
    
types = ["Kosetice","Pallas","Rigi","Hyytiele","JFJ","HPB","Sirta","Zeppelin","Peyrusse","MtCimone","Harwell","Auchencorth","CapVerde","Tardiere"];

colorScale = d3.scale.ordinal()
  .domain(types)
  .range(["#96abb1", "#313746", "#b0909d", "#687a97", "#292014"]);

d3.csv("station_status.csv", function (csv) {

var timelineStart = new Date("1/1/2014");
var timelineEnd = new Date("1/1/2020");
        
//var getStartYear = timelineStart.getFullYear();
//var getEndYear = timelineEnd.getFullYear();    
        
var timeline = d3.layout.timeline()
    .size([500,80])
    .extent([timelineStart, timelineEnd])
    //.extent(["1/1/2014", "1/1/2020"])
    .padding(3)
    .maxBandHeight(40);

var margin = {top: 20, right: 0, bottom: 40, left: 0},
    width = 1250 - margin.left - margin.right,
    height = 850 - margin.top - margin.bottom;

//Create the SVG canvas   
var svg = d3.select("#timeline_plot").append("svg")
    //.attr("id","timeline_plot")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")"); 
    
var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])
  .html(function(d) {
    return "<span style='color:red'>Station Name: </span>" + d.stationName + "</br>" + "<span style='color:red'>Status: </span>" + "<span style='color:white'>" + d.status + "</span> </br> " + "<span style='color:red'>Comment: </span>" + d.comment;
  })
    
var axisScale = d3.time.scale()
                        //.domain([minDate, maxDate])
                        .domain([new Date("1/1/2011"), new Date("1/1/2018")])
                        .range([200, 780]);
        
//Create the Axis
var xAxis = d3.svg.axis()         
            .scale(axisScale);
   
var datesArray = [];
var yearsArray = [];
    
var minDate = new Date(Math.min.apply(null,datesArray));
var maxDate = new Date(Math.max.apply(null,datesArray));
    
types.forEach(function (type, i) {
  onlyThisType = csv.filter(function(d) {return d.stationName === type});

  theseBands = timeline(onlyThisType);

if( i < 1 ) {
    
csv.filter(function (d, i) {
        datesArray.push(new Date(d.start));
        datesArray.push(new Date(d.end));

});    
    
}
                
d3.select("svg").append("g")
  .attr("transform", "translate(450," + (35 + (i * 50)) + ")")
  .selectAll("rect")
  .data(theseBands)
  .enter()
  .append("rect")
  .attr("rx", 2)
  .attr("x", function (d) {return d.start})
  /*.attr("y", function (d) {return d.y})*/
  .attr("height", function (d) {return d.dy})
  .attr("width", function (d) {return d.end - d.start})
  .style("fill", function (d) {return d.stationName})
  .style("fill", function (d) {return d.statusColor})
  .style("stroke", "black")
  .style("stroke-width", 1)
  .on('mouseover', tip.show)
  .on('mouseout', tip.hide);

  d3.select("svg").append("text")
  .text(type)
  .attr("font-weight","bold")
  .attr("y", 60 + (i * 50))
  .attr("x", 100); 

  d3.select("svg").append("text")
  .text("Go to Mantis issue to learn more")
  .data(theseBands)
  .attr("y", 60 + (i * 50))
  .attr("x", 820)
  .on("mouseover", function(d) {
    d3.select(this).style("fill", "grey");
  }) 
  .on("mouseout", function(d) {
  d3.select(this).style("fill", "black");
  })
  .on("click", function(d) { window.open(d.mantisLink); }); 

})

svg.call(tip);

//Draw the x axis to a group element     
svg.append("g")
      .attr("class", "axis")
      .attr("transform", "translate(0," + (height) + ")")
      .call(xAxis); 

    d3.selectAll("g.tick line")
    .attr("y2", function(d){
        return -height;
    });    
    
d3.selectAll("g").filter(function(d) { return d; })
    .classed("minor", true);

})

</script>

<div class="alert alert-warning" role="alert" style="margin-left:200px;margin-right:400px;">
<p class="about"><strong>Heads up!</strong></p>
<p class="about">Move your mouse over an element on the timeline to get information for a specific time-span</p>
<p class="about">Clicking on "Go to Mantis to learn more" will direct you to the Mantis issue tracker portal for the listed station  
</div>    

<div class='my-legend' >
<!--<div class='legend-title'>Legend:</div>-->
<div class='legend-scale'>
  <ul class='legend-labels'>
    <li><span style='background:yellow;'></span><p class="legend-text">Data received by ebas-submit. Awaits checking by EMPA/NILU</p></li>
    <li><span style='background:orange;'></span><p class="legend-text">Data checked by EMPA/NILU. Awaits revised data and response from data provider</p></li>
    <li><span style='background:red;'></span><p class="legend-text">Data checked by EMPA/NILU. Awaits revised data and/or response by data provider or EMPA/NILU. Passed deadline!</p></li>
    <li><span style='background:steelblue;'></span><p class="legend-text">Final data are in EBAS. Everything ok</p></li>
    <li><span style='background:grey;'></span><p class="legend-text">no info</p></li>
  </ul>
</div>
</div>    
    
<div id="timeline_plot"></div>
    

    
<style type='text/css'>
  
    .legend-text {
        /*font-size: 1.2em;*/
        font-size:15px;
    }
    
  .my-legend .legend-title {
    text-align: left;
    margin-bottom: 5px;
    font-weight: bold;
    font-size: 120%;
    }
    
  .my-legend .legend-scale ul {
    margin: 0;
    margin-bottom: 5px;
    padding: 0;
    /*float: left;*/
    list-style: none;
    }
    
  .my-legend .legend-scale ul li {
    font-size: 100%;
    list-style: none;
    margin-left: 0;
    line-height: 18px;
    margin-bottom: 2px;
    }
    
  .my-legend ul.legend-labels li span {
    display: block;
    float: left;
    height: 16px;
    width: 30px;
    margin-right: 5px;
    margin-left: 0;
    border: 1px solid #999;
    }
    
  .my-legend a {
    color: #777;
    }
</style> 
    
</div>
    
</body>
    
<footer>
</footer>

</html>
